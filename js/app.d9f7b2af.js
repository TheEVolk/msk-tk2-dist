(function(e){function t(t){for(var r,a,o=t[0],u=t[1],s=t[2],l=0,h=[];l<o.length;l++)a=o[l],Object.prototype.hasOwnProperty.call(c,a)&&c[a]&&h.push(c[a][0]),c[a]=0;for(r in u)Object.prototype.hasOwnProperty.call(u,r)&&(e[r]=u[r]);d&&d(t);while(h.length)h.shift()();return i.push.apply(i,s||[]),n()}function n(){for(var e,t=0;t<i.length;t++){for(var n=i[t],r=!0,a=1;a<n.length;a++){var o=n[a];0!==c[o]&&(r=!1)}r&&(i.splice(t--,1),e=u(u.s=n[0]))}return e}var r={},a={app:0},c={app:0},i=[];function o(e){return u.p+"js/"+({}[e]||e)+"."+{"chunk-2d2288d1":"739fd6e5","chunk-42d462ae":"2abb038b","chunk-becb84c0":"da81591d","chunk-0b5f2a88":"f90d6af1","chunk-4cbe8016":"b37b7ab0","chunk-2186dd30":"15f624ba","chunk-226783b7":"2be576f9","chunk-269a715c":"b38f66d0","chunk-29cee60a":"96f020b9","chunk-b6c0e698":"dbc6318a","chunk-738192c6":"79fda07f","chunk-c470d4bc":"a7bdebd8","chunk-2d0ddc7a":"83f2daa1","chunk-7b2bd3f0":"cabf9262","chunk-8dd214e6":"fcc7d251","chunk-d4dd6fd4":"5ecabbbb","chunk-3a4e4332":"fc172769","chunk-75792e38":"96ad0ee5","chunk-86800b9c":"e5ce1fde","chunk-f82d98be":"375757bf","chunk-70dad62e":"d2dd88db","chunk-8e147e2c":"27b18633","chunk-9d5641a0":"f519114a"}[e]+".js"}function u(t){if(r[t])return r[t].exports;var n=r[t]={i:t,l:!1,exports:{}};return e[t].call(n.exports,n,n.exports,u),n.l=!0,n.exports}u.e=function(e){var t=[],n={"chunk-becb84c0":1,"chunk-0b5f2a88":1,"chunk-4cbe8016":1,"chunk-2186dd30":1,"chunk-226783b7":1,"chunk-269a715c":1,"chunk-29cee60a":1,"chunk-b6c0e698":1,"chunk-738192c6":1,"chunk-c470d4bc":1,"chunk-7b2bd3f0":1,"chunk-8dd214e6":1,"chunk-d4dd6fd4":1,"chunk-75792e38":1,"chunk-f82d98be":1,"chunk-70dad62e":1,"chunk-8e147e2c":1,"chunk-9d5641a0":1};a[e]?t.push(a[e]):0!==a[e]&&n[e]&&t.push(a[e]=new Promise((function(t,n){for(var r="css/"+({}[e]||e)+"."+{"chunk-2d2288d1":"31d6cfe0","chunk-42d462ae":"31d6cfe0","chunk-becb84c0":"79ee3600","chunk-0b5f2a88":"fd25dc4b","chunk-4cbe8016":"a852e89e","chunk-2186dd30":"509272a8","chunk-226783b7":"b8d98f21","chunk-269a715c":"f2daaa08","chunk-29cee60a":"178fd958","chunk-b6c0e698":"6bb1e477","chunk-738192c6":"4299e5a7","chunk-c470d4bc":"e96654fb","chunk-2d0ddc7a":"31d6cfe0","chunk-7b2bd3f0":"509272a8","chunk-8dd214e6":"845c1af7","chunk-d4dd6fd4":"509272a8","chunk-3a4e4332":"31d6cfe0","chunk-75792e38":"a82d081e","chunk-86800b9c":"31d6cfe0","chunk-f82d98be":"cb4d0868","chunk-70dad62e":"cc8ce17b","chunk-8e147e2c":"cc8ce17b","chunk-9d5641a0":"cc8ce17b"}[e]+".css",c=u.p+r,i=document.getElementsByTagName("link"),o=0;o<i.length;o++){var s=i[o],l=s.getAttribute("data-href")||s.getAttribute("href");if("stylesheet"===s.rel&&(l===r||l===c))return t()}var h=document.getElementsByTagName("style");for(o=0;o<h.length;o++){s=h[o],l=s.getAttribute("data-href");if(l===r||l===c)return t()}var d=document.createElement("link");d.rel="stylesheet",d.type="text/css",d.onload=t,d.onerror=function(t){var r=t&&t.target&&t.target.src||c,i=new Error("Loading CSS chunk "+e+" failed.\n("+r+")");i.code="CSS_CHUNK_LOAD_FAILED",i.request=r,delete a[e],d.parentNode.removeChild(d),n(i)},d.href=c;var f=document.getElementsByTagName("head")[0];f.appendChild(d)})).then((function(){a[e]=0})));var r=c[e];if(0!==r)if(r)t.push(r[2]);else{var i=new Promise((function(t,n){r=c[e]=[t,n]}));t.push(r[2]=i);var s,l=document.createElement("script");l.charset="utf-8",l.timeout=120,u.nc&&l.setAttribute("nonce",u.nc),l.src=o(e);var h=new Error;s=function(t){l.onerror=l.onload=null,clearTimeout(d);var n=c[e];if(0!==n){if(n){var r=t&&("load"===t.type?"missing":t.type),a=t&&t.target&&t.target.src;h.message="Loading chunk "+e+" failed.\n("+r+": "+a+")",h.name="ChunkLoadError",h.type=r,h.request=a,n[1](h)}c[e]=void 0}};var d=setTimeout((function(){s({type:"timeout",target:l})}),12e4);l.onerror=l.onload=s,document.head.appendChild(l)}return Promise.all(t)},u.m=e,u.c=r,u.d=function(e,t,n){u.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},u.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},u.t=function(e,t){if(1&t&&(e=u(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(u.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)u.d(n,r,function(t){return e[t]}.bind(null,r));return n},u.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return u.d(t,"a",t),t},u.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},u.p="/",u.oe=function(e){throw console.error(e),e};var s=window["webpackJsonp"]=window["webpackJsonp"]||[],l=s.push.bind(s);s.push=t,s=s.slice();for(var h=0;h<s.length;h++)t(s[h]);var d=l;i.push([0,"chunk-vendors"]),n()})({0:function(e,t,n){e.exports=n("56d7")},"04e5":function(e,t,n){"use strict";var r=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("v-app-bar",{attrs:{app:"","clipped-right":"","clipped-left":"",flat:"",height:"32"}},[n("v-tabs",{attrs:{"align-with-title":"","show-arrows":""},model:{value:e.tabMgr.index,callback:function(t){e.$set(e.tabMgr,"index",t)},expression:"tabMgr.index"}},[n("v-tabs-slider",{staticClass:"accent lighten-4"}),e._l(e.tabMgr.list,(function(t,r){return n("v-tooltip",{key:r,attrs:{bottom:""},scopedSlots:e._u([{key:"activator",fn:function(a){var c=a.on,i=a.attrs;return[n("v-tab",e._g(e._b({directives:[{name:"longclick",rawName:"v-longclick",value:e.reload,expression:"reload"}],style:t.color?"border-top: 2px solid "+t.color+";":"",on:{dblclick:e.reload}},"v-tab",i,!1),c),[e._v(" "+e._s(t.title)+" "),n("v-btn",{attrs:{small:"",icon:""},on:{click:function(){return e.tabMgr.close(r)}}},[n("v-icon",{attrs:{small:""}},[e._v("mdi-close")])],1)],1)]}}],null,!0)},[n("span",[e._v(e._s(t.fullTitle||t.title))])])}))],2)],1)},a=[],c={methods:{reload:function(){this.$emit("reload")}}},i=c,o=n("2877"),u=n("6544"),s=n.n(u),l=n("40dc"),h=n("8336"),d=n("132d"),f=n("71a3"),p=n("fe57"),b=n("9a96"),k=n("3a2f"),v=Object(o["a"])(i,r,a,!1,null,null,null);t["a"]=v.exports;s()(v,{VAppBar:l["a"],VBtn:h["a"],VIcon:d["a"],VTab:f["a"],VTabs:p["a"],VTabsSlider:b["a"],VTooltip:k["a"]})},"0744":function(e,t,n){var r={"./electronPlatform.js":["e855","chunk-42d462ae"],"./webPlatform.js":["da53","chunk-2d2288d1"]};function a(e){if(!n.o(r,e))return Promise.resolve().then((function(){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}));var t=r[e],a=t[0];return n.e(t[1]).then((function(){return n(a)}))}a.keys=function(){return Object.keys(r)},a.id="0744",e.exports=a},1:function(e,t){},"162e":function(e,t,n){"use strict";var r=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("v-container",{attrs:{"fill-height":""}},[n("v-row",{staticClass:"fill-height",attrs:{"align-content":"center",justify:"center"}},[n("v-col",{staticClass:"subtitle-1 text-center",attrs:{cols:"12"}},[e._v(e._s(e.core.state.data))]),n("v-col",{attrs:{cols:"6"}},[n("v-progress-linear",{attrs:{color:"deep-purple accent-4",indeterminate:"",rounded:"",height:"6"}})],1)],1)],1)},a=[],c=n("2877"),i=n("6544"),o=n.n(i),u=n("62ad"),s=n("a523"),l=n("8e36"),h=n("0fd9"),d={},f=Object(c["a"])(d,r,a,!1,null,null,null);t["a"]=f.exports;o()(f,{VCol:u["a"],VContainer:s["a"],VProgressLinear:l["a"],VRow:h["a"]})},2:function(e,t){},3:function(e,t){},4:function(e,t){},"56d7":function(e,t,n){"use strict";n.r(t);n("e260"),n("e6cf"),n("cca6"),n("a79d");var r=n("9483");Object(r["a"])("".concat("/","service-worker.js"),{ready:function(){console.log("App is being served from cache by a service worker.\nFor more details, visit https://goo.gl/AFskqB")},registered:function(){console.log("Service worker has been registered.")},cached:function(){console.log("Content has been cached for offline use.")},updatefound:function(){console.log("New content is downloading.")},updated:function(){console.log("New content is available; please refresh.")},offline:function(){console.log("No internet connection found. App is running in offline mode.")},error:function(e){console.error("Error during service worker registration:",e)}});var a=n("a026"),c=n("3003"),i=function(){var e=this,t=e.$createElement,n=e._self._c||t;return"main"!==e.core.state.type?n("v-app",{class:e.core.mobile?"mobile":"desktop",attrs:{id:"inspire"}},["electron"===e.platform.type?n("SystemBar"):e._e(),"auth"===e.core.state.type?n("Auth"):n("Loading")],1):n("v-app",{class:e.core.mobile?"mobile":"desktop",attrs:{id:"inspire"}},["electron"===e.platform.type?n("SystemBar"):e._e(),n("AppBar",{on:{reload:e.reload}}),n("TabRenderer")],1)},o=[],u=n("6556"),s=u["a"],l=(n("b965"),n("2877")),h=n("6544"),d=n.n(h),f=n("7496"),p=Object(l["a"])(s,i,o,!1,null,null,null),b=p.exports;d()(p,{VApp:f["a"]});var k=n("826c"),v=(n("99af"),n("4de4"),n("a15b"),n("d81d"),n("b0c0"),n("4fad"),n("c1f9"),n("b64b"),n("d3b7"),n("4d63"),n("ac1f"),n("25f0"),n("3ca3"),n("466d"),n("5319"),n("ddb0"),n("2b3d"),n("5530")),m=(n("96cf"),n("1da1")),g=n("d4ec"),y=n("bee2"),w=n("a34a"),x=n.n(w),O=n("7a51"),j=n.n(O),T=n("92d7"),_=n.n(T),S=n("d6fe"),A=n.n(S),C=n("1c46"),N=n.n(C);class E extends Error{constructor(e,t,n){super(t),this.slug=e,this.message=t,this.data=n}toJson(){return JSON.stringify({error:{slug:this.slug,message:this.message,data:this.data}})}}class M{constructor(e){this.options=e,[this.authCode,this.secret]=e.token.split(":")}createSignature(e,t,n,r,a){return N.a.createHmac("sha256",a).update(`${e}|${t}|${n}|${JSON.stringify(r||{})}`).digest("hex")}async rawQuery(e,t,n={},r={}){const a=await A()(`${this.options.baseUrl}${t}?${new URLSearchParams(n)}`,{method:e,headers:{"Content-Type":"application/json"},..."get"===e?{}:{body:JSON.stringify(r)}}).then(e=>e.json());if(a.error)throw new E(a.error.slug,a.error.message,a.error.data);return a.data}async query(e,t,n={}){const r=Array.isArray(t)?t.join("/"):t,a=this.createSignature(r,e,this.authCode,n,this.secret);return this.rawQuery(e,r,{auth:this.authCode,signature:a},n)}}var L=function(){function e(){var t=this;Object(g["a"])(this,e),this.status="not_authorized",this.client=new M({baseUrl:"https://tkb.tk2.u14t.ru/api/",token:this.token}),this.token&&this.checkToken(),setInterval((function(){"authorized"===t.status&&t.query("put","staff/shift").catch((function(){t.status="not_authorized"}))}),6e4)}return Object(y["a"])(e,[{key:"token",get:function(){return localStorage.tkbToken||""},set:function(e){console.log(e),this.client.options.token=e,localStorage.tkbToken=e}},{key:"checkToken",value:function(){var e=Object(m["a"])(x.a.mark((function e(){var t;return x.a.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return this.status="authorization",e.next=3,this.query("put","staff/shift").then((function(){return!0})).catch((function(){return!1}));case 3:if(t=e.sent,t){e.next=7;break}return this.status="not_authorized",e.abrupt("return");case 7:this.status="authorized";case 8:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"query",value:function(){var e=Object(m["a"])(x.a.mark((function e(t,n){var r,a=arguments;return x.a.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return r=a.length>2&&void 0!==a[2]?a[2]:{},e.abrupt("return",this.client.query(t,n,r));case 2:case"end":return e.stop()}}),e,this)})));function t(t,n){return e.apply(this,arguments)}return t}()}]),e}(),z=new L;a["a"].mixin({data:function(){return{tkb:z}}});var P=z,V=function(){function e(t){Object(g["a"])(this,e),this.root=t,this.cache={}}return Object(y["a"])(e,[{key:"get",value:function(e){return this.cache[e]||(this.cache[e]={alive:!1,services:[],loading:!0,ip:e}),this.update(this.cache[e]),this.cache[e]}},{key:"update",value:function(){var e=Object(m["a"])(x.a.mark((function e(t){return x.a.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return t.loading=!0,e.t0=Object,e.t1=t,e.next=5,P.query("get","util/ip/".concat(t.ip));case 5:e.t2=e.sent,e.t0.assign.call(e.t0,e.t1,e.t2),t.loading=!1;case 8:case"end":return e.stop()}}),e)})));function t(t){return e.apply(this,arguments)}return t}()}]),e}(),q=n("2f62"),U=n("0e44"),$=(n("4160"),n("caad"),n("2532"),n("159b"),function(){function e(){var t=this;Object(g["a"])(this,e),this.type=window&&window.process&&window.process.type?"electron":"web",n("0744")("./".concat(this.type,"Platform.js")).then((function(e){t.realization=e["default"]}))}return Object(y["a"])(e,[{key:"send",value:function(e){var t;if(this.realization){for(var n=arguments.length,r=new Array(n>1?n-1:0),a=1;a<n;a++)r[a-1]=arguments[a];(t=this.realization).send.apply(t,[e].concat(r))}}},{key:"openPanelWindow",value:function(e,t){this.realization&&this.realization.openPanelWindow(e,t)}},{key:"openUrl",value:function(e){this.realization&&this.realization.openUrl(e)}}]),e}()),B=new $;a["a"].mixin({data:function(){return{platform:B}}});var K=B,R=n("3835"),I=function(){function e(){Object(g["a"])(this,e)}return Object(y["a"])(e,[{key:"getAvatar",value:function(e){var t=X.emailByName(e);return H.state.persist.avatarCache[t]?"https://my.msk.host/manimg/userdata/avatar_files/".concat(H.state.persist.avatarCache[t]):"https://my.msk.host/manimg/userdata/img/customer.png"}},{key:"setAvatar",value:function(e,t){var n=t.match(/avatar_files\/(.+)$/)||[],r=Object(R["a"])(n,2),a=(r[0],r[1]);if(a){var c=X.emailByName(e);H.commit({type:"setAvatar",client:c,avatar:a})}}}]),e}(),F=new I;a["a"].mixin({data:function(){return{avatarCache:F}}});var J=F,D={state:{list:[],oldUnreadList:null},mutations:{updateTicketList:function(e,t){var n=t.list;e.list=n,K.send("update-badge",n.length||null);var r=e.list.filter((function(e){return e.unread}));window.document.title="TK2 [".concat(n.length,"/").concat(r.length,"]"),e.oldUnreadList||(e.oldUnreadList=r.map((function(e){return e.id})));var a=r.filter((function(t){return!e.oldUnreadList.includes(t.id)}));a.forEach(function(){var e=Object(m["a"])(x.a.mark((function e(t){var n,r;return x.a.wrap((function(e){while(1)switch(e.prev=e.next){case 0:n=new Notification("#".concat(t.ticket," ").concat(t.name),{body:t.client,silent:!0,icon:J.getAvatar(t.client)}),r=new Audio("/sounds/notify.mp3"),r.play(),K.send("flash"),n.onclick=function(){k["a"].open("Ticket",{ticketId:t.ticket,elId:t.id}),K.send("focus")};case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),e.oldUnreadList=r.map((function(e){return e.id}))}}};a["a"].use(q["a"]);var W=new q["a"].Store({plugins:[Object(U["a"])({paths:["persist"]})],modules:{ticket:D},state:{persist:{dark:!1,avatarCache:{}}},mutations:{updateTheme:function(e,t){var n=t.isDark;e.persist.dark=n},setAvatar:function(e,t){var n=t.client,r=t.avatar;e.persist.avatarCache[n]=r}}}),H=W,G=function(){function e(){var t=this;Object(g["a"])(this,e),this.status="not_authorized",this.ipService=new V(this),this.url="https://api.tk2.u14t.ru",this.userInfo=null,this.token&&this.checkToken(),setInterval((function(){return t.updateTicketList()}),1e4)}return Object(y["a"])(e,[{key:"token",get:function(){return localStorage.apiToken},set:function(e){localStorage.apiToken=e}},{key:"setStatus",value:function(e){this.status=e,"authorized"===e&&(this.updateTicketList(),this.getDesktop())}},{key:"updateTicketList",value:function(){var e=Object(m["a"])(x.a.mark((function e(){var t;return x.a.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if("authorized"===this.status){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,this.exec("ticket");case 4:t=e.sent,H.commit({type:"updateTicketList",list:t});case 6:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"checkToken",value:function(){var e=Object(m["a"])(x.a.mark((function e(){var t;return x.a.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return this.setStatus("token_check"),e.next=3,this.query({auth:this.token,func:"ticket"});case 3:if(t=e.sent,!t.error){e.next=10;break}if("У вас недостаточно прав на выполнение функции '__value__'"!==t.error.detail){e.next=9;break}return console.warn("Сессия BillManager истекла. Переподключение..."),this.setStatus("not_authorized"),e.abrupt("return",!1);case 9:throw Error(t.error.msg);case 10:return this.setStatus("authorized"),e.abrupt("return",!0);case 12:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"getDesktop",value:function(){var e=Object(m["a"])(x.a.mark((function e(){return x.a.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(this.token){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,this.func("desktop");case 4:if(this.desktop=e.sent,console.log(this.desktop),this.desktop){e.next=8;break}return e.abrupt("return");case 8:this.userInfo={realname:this.desktop.user.attr["@_realname"],name:this.desktop.user.attr["@_name"],avatar:this.desktop.user.attr["@_avatar_src"]};case 9:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"auth",value:function(){var e=Object(m["a"])(x.a.mark((function e(t){var n;return x.a.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return console.log("Авторизация в BillManager..."),e.next=3,this.query({func:"auth",username:t.username,password:t.password,out:"xml"});case 3:if(n=e.sent,!n.error){e.next=6;break}throw Error("Auth error: ".concat(n.error.msg));case 6:return this.token=n.auth,e.abrupt("return",n.auth);case 8:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"getCaptcha",value:function(){var e=Object(m["a"])(x.a.mark((function e(){var t;return x.a.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,this.query({func:"logon",out:"xml"});case 2:return t=e.sent,e.abrupt("return",t.recaptcha_field&&{recaptcha_field:t.recaptcha_field,recaptcha_type:t.recaptcha_type});case 4:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"exec2",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return fetch("".concat(this.url,"/api2/billmgr/").concat(e,"?").concat(new URLSearchParams(Object(v["a"])({auth:this.token},t)).toString())).then((function(e){return e.json()}))}},{key:"exec",value:function(){var e=Object(m["a"])(x.a.mark((function e(t){var n,r=arguments;return x.a.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return n=r.length>1&&void 0!==r[1]?r[1]:{},e.abrupt("return",this.rawJson(Object(v["a"])({func:t,auth:this.token},n)));case 2:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"rawJson",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return fetch("".concat(this.url,"?").concat(new URLSearchParams(Object(v["a"])({out:"JSONdata"},e)).toString()),{headers:new Headers({"User-Agent":"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/91.0.4472.124 Safari/537.36 Edg/91.0.864.64"})}).then((function(e){return e.text()})).then((function(e){return JSON.parse(e.replace(/\\'/g,"'"))}))}},{key:"query",value:function(){var e=Object(m["a"])(x.a.mark((function e(){var t,n,r=arguments;return x.a.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return t=r.length>0&&void 0!==r[0]?r[0]:{},e.next=3,fetch("".concat(this.url,"?").concat(new URLSearchParams(Object(v["a"])({out:"xml"},t)).toString()),{headers:{"User-Agent":"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/91.0.4472.124 Safari/537.36 Edg/91.0.864.64"}}).then((function(e){return e.text()}));case 3:if(n=e.sent,t.out&&""!==t.out&&"xml"!==t.out){e.next=6;break}return e.abrupt("return",j.a.parse(n,{attributeNamePrefix:"@_",attrNodeName:"attr",ignoreAttributes:!1,tagValueProcessor:function(e){return _.a.decode(e,{useNamedReferences:!0})},attrValueProcessor:function(e){return _.a.decode(e,{isAttributeValue:!0,useNamedReferences:!0})}}).doc);case 6:if("bjson"!==t.out&&"JSONdata"!==t.out){e.next=8;break}return e.abrupt("return",JSON.parse(n.replace(/\\'/g,"'")));case 8:return e.abrupt("return",n);case 9:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"raw",value:function(){var e=Object(m["a"])(x.a.mark((function e(){var t,n,r=arguments;return x.a.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return t=r.length>0&&void 0!==r[0]?r[0]:{},e.next=3,this.query(Object(v["a"])({auth:this.token},t));case 3:if(n=e.sent,!n.error){e.next=9;break}if("access"!==n.error.code||"ticket"!==t.func){e.next=8;break}return console.warn("Сессия BillManager истекла. Переподключение..."),e.abrupt("return",this.core.validateAuth());case 8:throw Error(n.error.msg);case 9:return e.abrupt("return",n);case 10:case"end":return e.stop()}}),e,this)})));function t(){return e.apply(this,arguments)}return t}()},{key:"func",value:function(){var e=Object(m["a"])(x.a.mark((function e(t){var n,r=arguments;return x.a.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return n=r.length>1&&void 0!==r[1]?r[1]:{},e.abrupt("return",this.raw(Object(v["a"])({func:t},n)));case 2:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"array",value:function(){var e=Object(m["a"])(x.a.mark((function e(t){var n,r,a=arguments;return x.a.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return n=a.length>1&&void 0!==a[1]?a[1]:{},e.next=3,this.raw(Object(v["a"])({func:t},n));case 3:if(r=e.sent,!r.list){e.next=6;break}return e.abrupt("return",r.list.elem);case 6:if(r.elem){e.next=8;break}return e.abrupt("return",[]);case 8:return e.abrupt("return",Array.isArray(r.elem)?r.elem:[r.elem]);case 9:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"forceArray",value:function(e){return Array.isArray(e)?e:[e]}},{key:"findFiltered",value:function(){var e=Object(m["a"])(x.a.mark((function e(t,n){var r;return x.a.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.t0=Promise,e.t1=this.exec("tsetting",{sok:"ok",elid:t,ratelimit:200}),e.next=4,this.exec("".concat(t,".filter"),{sok:"ok",drop:"on"});case 4:return e.t2=e.sent,e.t3=[e.t1,e.t2],e.next=8,e.t0.all.call(e.t0,e.t3);case 8:return e.next=10,this.exec("".concat(t,".filter"),Object(v["a"])({sok:"ok"},n));case 10:return console.log("..."),e.next=13,this.exec(t,{sok:"ok",out:"html"});case 13:return r=e.sent,console.log("parse filtered..."),e.abrupt("return",{headers:Object.fromEntries(r.headers.map((function(e){return[e.name,e.pName]}))),data:r.content.map((function(e){return Object.fromEntries(Object.entries(e).map((function(e){return[e[0],e[1].v]})).filter((function(e){return e[1]})))}))});case 16:case"end":return e.stop()}}),e,this)})));function t(t,n){return e.apply(this,arguments)}return t}()},{key:"emailByName",value:function(e){var t=e.match(/.+ \((.+)\)/);return t?t[1]:e}},{key:"decodeHTMLEntities",value:function(e){var t={amp:"&",apos:"'","#x27":"'","#x2F":"/","#39":"'","#47":"/",lt:"<",gt:">",nbsp:" ",quot:'"'};return e.replace(new RegExp("&?:(".concat(Object.keys(t).join("|"),");"),"g"),(function(e){return t[e]}))}}]),e}(),Q=new G;a["a"].mixin({data:function(){return{api:Q}}});var X=Q,Y=function(){function e(){var t=this;Object(g["a"])(this,e),this.mobile=window.innerWidth<600,window.addEventListener("resize",(function(){t.mobile=window.innerWidth<600}))}return Object(y["a"])(e,[{key:"state",get:function(){var e={api:{not_authorized:{type:"auth"},token_check:{type:"loading",data:"Восстановление сессии в биллинге..."},authorization:{type:"loading",data:"Авторизация в биллинге..."}},tkb:{not_authorized:{type:"auth"},authorization:{type:"loading",data:"Авторизация в TKB..."}}};return e.api[X.status]||e.tkb[P.status]||{type:"main"}}}]),e}(),Z=new Y;a["a"].mixin({data:function(){return{core:Z}}});Object(r["a"])("".concat("/","service-worker.js"),{ready:function(){console.log("App is being served from cache by a service worker.\nFor more details, visit https://goo.gl/AFskqB")},registered:function(){console.log("Service worker has been registered.")},cached:function(){console.log("Content has been cached for offline use.")},updatefound:function(){console.log("New content is downloading.")},updated:function(){console.log("New content is available; please refresh.")},offline:function(){console.log("No internet connection found. App is running in offline mode.")},error:function(e){console.error("Error during service worker registration:",e)}});var ee=n("616f"),te=Object(ee["longClickDirective"])({delay:400,interval:0});a["a"].directive("longclick",te);var ne=n("f309");a["a"].use(ne["a"]);var re=new ne["a"]({theme:{options:{customProperties:!0},themes:{light:{accent:"#000000",background:"#e8e9f7",cards:"white",messagemine:"white",messageother:"white",text:"#000000"},dark:{accent:"#3a093e",background:"#05070f",cards:"#11131e","cards-darken1":"#11131f",messagemine:"#3a093e",messageother:"#0b0c13",primary:"#003784",text:"#ffffff"}}}});a["a"].config.productionTip=!1,a["a"].use(c["a"]),window.vue=new a["a"]({store:H,vuetify:re,render:function(e){return e(b)}}).$mount("#app")},6556:function(e,t,n){"use strict";(function(e){n("d3b7");var r=n("6ada"),a=n("04e5"),c=n("162e"),i=n("f5e7");t["a"]={components:{SystemBar:function(){return n.e("chunk-f82d98be").then(n.bind(null,"c7cf"))},Auth:r["a"],Loading:c["a"],AppBar:a["a"],TabRenderer:i["a"]},name:"TK2",data:function(){return{transitionName:"fade-in"}},created:function(){var e=this.$store.state.persist.dark;this.$vuetify.theme.dark=e},methods:{reload:function(){var t=this,n=this.tabMgr.get(),r=n.location;n&&(delete this.tabMgr.get().saved,n.location="reloading");var a=this.tabMgr.index;this.tabMgr.index=-1,e.nextTick((function(){t.tabMgr.index=a,n&&(n.location=r)}))}},computed:{component:function(){return this.tabMgr.list[this.tabMgr.index]?this.tabMgr.list[this.tabMgr.index].component:"Null"},location:function(){return document.location.href}}}}).call(this,n("4362"))},"6ada":function(e,t,n){"use strict";var r=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("v-main",{staticStyle:{height:"100%"}},[n("v-layout",{attrs:{column:"","justify-center":"","align-center":"","fill-height":""}},[n("v-flex",{attrs:{xs3:""}},[n("h1",{staticClass:"display-3"},[e._v("TK2")])]),n("v-flex",{attrs:{xs4:"","text-center":""}},[n("div",{staticClass:"content"},[n("v-form",{ref:"form",attrs:{"lazy-validation":""}},[n("v-text-field",{attrs:{name:"login",label:"Логин",required:""},model:{value:e.username,callback:function(t){e.username=t},expression:"username"}}),n("v-text-field",{attrs:{name:"password",type:"password",label:"Пароль",required:""},model:{value:e.password,callback:function(t){e.password=t},expression:"password"}}),n("v-text-field",{attrs:{name:"tkb-token",type:"password",label:"Токен TKB",required:""},model:{value:e.tkbToken,callback:function(t){e.tkbToken=t},expression:"tkbToken"}}),e.captcha?n("vue-recaptcha",{attrs:{sitekey:e.captcha.recaptcha_field}}):e._e(),n("v-btn",{staticClass:"mr-4",attrs:{color:"success"},on:{click:e.auth}},[e._v("Войти")])],1)],1)])],1)],1)},a=[],c=(n("96cf"),n("1da1")),i=n("a34a"),o=n.n(i),u=n("e096"),s={name:"Auth",components:{VueRecaptcha:u["a"]},data:function(){return{captcha:null,username:localStorage.username||"",password:localStorage.password||"",tkbToken:localStorage.tkbToken||""}},mounted:function(){var e=this;return Object(c["a"])(o.a.mark((function t(){return o.a.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.api.getCaptcha();case 2:e.captcha=t.sent;case 3:case"end":return t.stop()}}),t)})))()},methods:{auth:function(){var e=this;return Object(c["a"])(o.a.mark((function t(){return o.a.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return localStorage.username=e.username,localStorage.password=e.password,localStorage.tkbToken=e.tkbToken,t.prev=3,t.next=6,e.authApi();case 6:return t.next=8,e.authTkb();case 8:t.next=15;break;case 10:t.prev=10,t.t0=t["catch"](3),e.api.setStatus("not_authorized"),e.tkb.status="not_authorized",alert(t.t0.message);case 15:case"end":return t.stop()}}),t,null,[[3,10]])})))()},authApi:function(){var e=this;return Object(c["a"])(o.a.mark((function t(){var n;return o.a.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.api.setStatus("authorization"),t.next=3,e.api.query({func:"auth",username:e.username,password:e.password,out:"bjson"});case 3:if(n=t.sent,!n.error){t.next=6;break}throw Error("Ошибка во время авторизации: ".concat(n.error.msg));case 6:e.api.token=n.model.auth,e.api.setStatus("authorized");case 8:case"end":return t.stop()}}),t)})))()},authTkb:function(){var e=this;return Object(c["a"])(o.a.mark((function t(){return o.a.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.tkb.token=e.tkbToken,e.tkb.status="authorization",t.next=4,e.tkb.query("put","staff/shift").then((function(){return!0}));case 4:e.tkb.status="authorized";case 5:case"end":return t.stop()}}),t)})))()}}},l=s,h=n("2877"),d=n("6544"),f=n.n(d),p=n("8336"),b=n("0e8f"),k=n("4bd4"),v=n("a722"),m=n("f6c4"),g=n("8654"),y=Object(h["a"])(l,r,a,!1,null,null,null);t["a"]=y.exports;f()(y,{VBtn:p["a"],VFlex:b["a"],VForm:k["a"],VLayout:v["a"],VMain:m["a"],VTextField:g["a"]})},"826c":function(e,t,n){"use strict";n("99af"),n("4de4"),n("7db0"),n("4160"),n("caad"),n("c975"),n("a434"),n("c1f9"),n("d3b7"),n("2532"),n("3ca3"),n("159b"),n("ddb0"),n("2b3d");var r=n("a026"),a={index:0,list:[],open:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],r=t?"".concat(e,"?").concat(new URLSearchParams(t)):e,c=a.list.find((function(e){return e.location===r}));if(c)return n&&(a.index=a.list.indexOf(c)),c;var i=r.indexOf("?"),o={location:r,component:-1===i?r:r.substring(0,i),query:-1!==i?Object.fromEntries(new URLSearchParams(r.substring(i))):{},saved:null,title:-1===i?r:r.substring(0,i),fullTitle:r};return a.list.push(o),n&&(a.index=a.list.length-1),o},close:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=null===e?a.list.indexOf(a.list[a.index]):e;-1!==t&&a.list.splice(t,1)},get:function(){var e=a.list[a.index]||a.list[0];return e||a.open("Overview")}};setInterval((function(){a.list.filter((function(e){return e.tick})).forEach((function(e){!e.tick.filter.includes("d")||document.hasFocus()?e.tick.filter.includes("t")&&a.get()!==e?e.tick.waitTick=!0:(e.tick.waitTick=!1,e.tick.callback(!1)):e.tick.waitTick=!0}))}),1e4),r["a"].mixin({data:function(){return{tabMgr:a}}}),t["a"]=a},b965:function(e,t,n){"use strict";n("e4db")},e4db:function(e,t,n){},f5e7:function(e,t,n){"use strict";var r=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("KeyKeepAlive",{attrs:{include:e.openedLocationKeys}},[n(e.component,{key:e.tabMgr.get().location,ref:"tab",tag:"component",attrs:{value:e.tabMgr.get(),tab:e.tabMgr.get()}})],1)},a=[];n("d81d"),n("d3b7"),n("4de4"),n("4160"),n("caad"),n("c975"),n("a434"),n("b0c0"),n("a9e3"),n("4fad"),n("4d63"),n("ac1f"),n("25f0"),n("2532"),n("1276"),n("159b"),n("ddb0");function c(e){return"[object RegExp]"===e.toString()}function i(e,t){if(e.length){var n=e.indexOf(t);if(n>-1)return e.splice(n,1)}}function o(e){return e&&(e.Ctor.options.name||e.tag)}function u(e){return Array.isArray(e)?e.indexOf(name)>-1:"string"===typeof e?e.split(",").indexOf(name)>-1:!!c(e)&&e.test(name)}function s(e,t){var n=e.cache,r=e.keys,a=e._vnode,c=Object.entries(n).filter((function(e){return e[1]})),i=c.filter((function(e){return!t(e[0])}));i.forEach((function(e){return l(n,e[0],r,a)}))}function l(e,t,n,r){var a=e[t];!a||r&&a.tag===r.tag||a.componentInstance.$destroy(),e[t]=null,i(n,t)}var h=[String,RegExp,Array],d={name:"key-keep-alive",abstract:!0,props:{include:h,exclude:h,max:[String,Number]},methods:{cacheVNode:function(){var e=this.cache,t=this.keys,n=this.vnodeToCache,r=this.keyToCache;if(n){var a=n.tag,c=n.componentInstance,i=n.componentOptions;e[r]={name:o(i),tag:a,componentInstance:c},t.push(r),this.max&&t.length>parseInt(this.max)&&l(e,t[0],t,this._vnode),this.vnodeToCache=null}}},created:function(){this.cache=Object.create(null),this.keys=[]},destroyed:function(){for(var e in this.cache)l(this.cache,e,this.keys)},mounted:function(){var e=this;this.cacheVNode(),this.$watch("include",(function(t){s(e,(function(e){return t.includes(e)}))})),this.$watch("exclude",(function(t){s(e,(function(e){return!u(t,e)}))}))},updated:function(){this.cacheVNode()},render:function(){var e=this.$slots.default,t=e[0],n=t&&t.componentOptions;if(n){var r=t.key||o(n),a=this.include,c=this.exclude;if(a&&(!r||!a.includes(r))||c&&r&&u(c,r))return t;var s=this.cache,l=this.keys,h=null==t.key?n.Ctor.cid+(n.tag?"::".concat(n.tag):""):t.key;s[h]?(t.componentInstance=s[h].componentInstance,i(l,h),l.push(h)):(this.vnodeToCache=t,this.keyToCache=h),t.data.keepAlive=!0}return t||e&&e[0]}},f={components:{KeyKeepAlive:d},name:"TK2",data:function(){return{transitionName:"fade-in"}},computed:{component:function(){var e=this;return console.log("вкладка",this.tabMgr.get().component),function(){return n("fff3")("./".concat(e.tabMgr.get().component,".vue"))}},openedLocationKeys:function(){return this.tabMgr.list.map((function(e){return e.location}))}}},p=f,b=n("2877"),k=Object(b["a"])(p,r,a,!1,null,null,null);t["a"]=k.exports},fff3:function(e,t,n){var r={"./Account.vue":["55b8","chunk-becb84c0","chunk-29cee60a","chunk-c470d4bc"],"./AllTickets.vue":["1f9d","chunk-becb84c0","chunk-226783b7"],"./Markus.vue":["7eba","chunk-becb84c0","chunk-8dd214e6"],"./MultiTicket.vue":["0517","chunk-becb84c0","chunk-269a715c"],"./Overview.vue":["dd34","chunk-becb84c0","chunk-d4dd6fd4","chunk-86800b9c"],"./RedateCalculator.vue":["839b","chunk-becb84c0","chunk-2d0ddc7a"],"./RefundCalculator.vue":["16fe","chunk-becb84c0","chunk-7b2bd3f0"],"./Service.vue":["6984","chunk-becb84c0","chunk-0b5f2a88","chunk-4cbe8016"],"./Services.vue":["f74a","chunk-becb84c0","chunk-29cee60a","chunk-738192c6"],"./Settings.vue":["bacd","chunk-becb84c0","chunk-2186dd30"],"./Staff.vue":["11fe","chunk-becb84c0","chunk-d4dd6fd4","chunk-3a4e4332"],"./Ticket.vue":["688e","chunk-becb84c0","chunk-29cee60a","chunk-0b5f2a88","chunk-b6c0e698"],"./Tickets.vue":["a981","chunk-becb84c0","chunk-d4dd6fd4","chunk-75792e38"]};function a(e){if(!n.o(r,e))return Promise.resolve().then((function(){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}));var t=r[e],a=t[0];return Promise.all(t.slice(1).map(n.e)).then((function(){return n(a)}))}a.keys=function(){return Object.keys(r)},a.id="fff3",e.exports=a}});
//# sourceMappingURL=app.d9f7b2af.js.map